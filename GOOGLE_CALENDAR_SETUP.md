# 구글 캘린더 연동 설정 가이드

이 문서는 심야 캘린더에 구글 캘린더 연동 기능을 설정하는 방법을 안내합니다.

## 📋 목차

1. [개요](#개요)
2. [구글 클라우드 프로젝트 설정](#구글-클라우드-프로젝트-설정)
3. [OAuth 2.0 클라이언트 ID 생성](#oauth-20-클라이언트-id-생성)
4. [환경 변수 설정](#환경-변수-설정)
5. [사용 방법](#사용-방법)
6. [문제 해결](#문제-해결)

## 개요

구글 캘린더 연동 기능을 사용하면:
- ✅ 구글 캘린더에서 이벤트 가져오기
- ✅ 구글 캘린더로 이벤트 보내기
- ✅ 양방향 동기화
- ✅ 자동 동기화 옵션

## 구글 클라우드 프로젝트 설정

### 1. Google Cloud Console 접속

1. [Google Cloud Console](https://console.cloud.google.com/)에 접속합니다
2. 로그인 후 새 프로젝트를 생성하거나 기존 프로젝트를 선택합니다

### 2. Google Calendar API 활성화

1. 좌측 메뉴에서 **API 및 서비스 > 라이브러리**를 클릭합니다
2. "Google Calendar API"를 검색합니다
3. **사용 설정** 버튼을 클릭하여 API를 활성화합니다

## OAuth 2.0 클라이언트 ID 생성

### 1. OAuth 동의 화면 구성

1. 좌측 메뉴에서 **API 및 서비스 > OAuth 동의 화면**을 클릭합니다
2. **외부** 사용자 유형을 선택하고 **만들기**를 클릭합니다
3. 필수 정보를 입력합니다:
   - **앱 이름**: 심야 캘린더 (또는 원하는 이름)
   - **사용자 지원 이메일**: 본인의 이메일
   - **개발자 연락처 정보**: 본인의 이메일
4. **저장 후 계속**을 클릭합니다

### 2. 범위(Scopes) 설정

1. **범위 추가 또는 삭제** 버튼을 클릭합니다
2. 다음 범위를 검색하여 추가합니다:
   - `https://www.googleapis.com/auth/calendar` - 구글 캘린더 읽기/쓰기
3. **업데이트**를 클릭한 후 **저장 후 계속**을 클릭합니다

### 3. 테스트 사용자 추가

1. **테스트 사용자 추가** 버튼을 클릭합니다
2. 본인의 Gmail 주소를 입력합니다
3. **추가**를 클릭한 후 **저장 후 계속**을 클릭합니다

### 4. OAuth 2.0 클라이언트 ID 생성

1. 좌측 메뉴에서 **API 및 서비스 > 사용자 인증 정보**를 클릭합니다
2. 상단의 **+ 사용자 인증 정보 만들기** 버튼을 클릭하고 **OAuth 클라이언트 ID**를 선택합니다
3. 애플리케이션 유형으로 **웹 애플리케이션**을 선택합니다
4. 이름을 입력합니다 (예: "심야 캘린더")
5. **승인된 리디렉션 URI** 섹션에서 **URI 추가** 버튼을 클릭하고 다음을 입력합니다:
   - `http://localhost:8080`
6. **만들기**를 클릭합니다

### 5. 클라이언트 ID 및 Secret 저장

생성된 팝업에서:
- **클라이언트 ID** (예: `123456789-abcdef.apps.googleusercontent.com`)
- **클라이언트 보안 비밀번호** (Client Secret)

이 두 값을 안전하게 저장해둡니다.

## 환경 변수 설정

### 개발 환경

프로젝트 루트에 `.env` 파일을 생성하고 다음 내용을 추가합니다:

\`\`\`env
VITE_GOOGLE_CLIENT_ID=여기에_클라이언트_ID_입력
VITE_GOOGLE_CLIENT_SECRET=여기에_클라이언트_Secret_입력
\`\`\`

**중요**: Vite 환경에서는 환경 변수명 앞에 `VITE_` 접두사가 필요합니다.

### 프로덕션 빌드

프로덕션 빌드 시에는 환경 변수를 안전하게 관리해야 합니다:

1. **macOS/Linux**: `~/.bashrc` 또는 `~/.zshrc`에 추가
2. **Windows**: 시스템 환경 변수에 추가

또는 Electron의 `app.getPath('userData')`에 설정 파일로 저장하는 방법도 있습니다.

## 사용 방법

### 1. 구글 캘린더 연동하기

1. 앱을 실행합니다
2. 설정 메뉴에서 "구글 캘린더 연동"을 클릭합니다
3. "구글 계정으로 인증" 버튼을 클릭합니다
4. 브라우저가 열리면 구글 계정으로 로그인하고 권한을 승인합니다
5. 인증 코드가 표시되면 복사합니다
6. 앱으로 돌아와 인증 코드를 입력하고 "연동 완료"를 클릭합니다

### 2. 이벤트 동기화

연동 후 다음 작업을 수행할 수 있습니다:

#### 가져오기
- "구글 캘린더 동기화" 메뉴를 엽니다
- 동기화 범위를 선택합니다 (1주일, 1개월, 1년, 전체)
- "가져오기" 버튼을 클릭합니다

#### 보내기
- "구글 캘린더 동기화" 메뉴를 엽니다
- "보내기" 버튼을 클릭합니다
- 모든 로컬 이벤트가 구글 캘린더로 전송됩니다

#### 양방향 동기화
- "양방향 동기화" 버튼을 클릭하면 양쪽 캘린더가 동기화됩니다

### 3. 자동 동기화 설정

1. "구글 캘린더 연동" 설정을 엽니다
2. "자동 동기화 활성화" 체크박스를 선택합니다
3. 이제 이벤트를 추가/수정할 때마다 자동으로 구글 캘린더와 동기화됩니다

## 문제 해결

### "Google Calendar not connected" 오류

**원인**: OAuth 인증이 완료되지 않았습니다.

**해결 방법**:
1. 구글 캘린더 연동 설정을 다시 실행합니다
2. 인증 코드를 올바르게 입력했는지 확인합니다

### "Failed to refresh access token" 오류

**원인**: Refresh Token이 만료되었거나 무효화되었습니다.

**해결 방법**:
1. 연동을 해제합니다
2. 다시 연동을 진행합니다

### 환경 변수가 인식되지 않음

**원인**: `.env` 파일이 올바르게 설정되지 않았거나 앱이 환경 변수를 읽지 못합니다.

**해결 방법**:
1. `.env` 파일이 프로젝트 루트에 있는지 확인합니다
2. 파일 내용이 올바른지 확인합니다
3. 앱을 재시작합니다

### OAuth 동의 화면에서 "이 앱은 확인되지 않았습니다" 경고

**원인**: 앱이 Google의 검증을 받지 않았습니다.

**해결 방법**:
1. "고급" 또는 "계속" 링크를 클릭합니다
2. 본인의 앱이므로 안전하게 진행할 수 있습니다
3. 공개 배포를 위해서는 Google의 앱 검증을 받아야 합니다

## 주요 파일 구조

\`\`\`
src/
├── types/index.ts                              # 구글 캘린더 타입 정의
├── services/
│   └── googleCalendarService.ts                # 구글 캘린더 API 서비스
├── hooks/
│   └── useGoogleCalendarSync.ts                # 동기화 커스텀 훅
└── components/
    └── GoogleCalendar/
        ├── GoogleCalendarSync.tsx              # 연동 설정 UI
        ├── GoogleCalendarSync.module.scss
        ├── GoogleCalendarSyncPanel.tsx         # 동기화 패널 UI
        └── GoogleCalendarSyncPanel.module.scss
\`\`\`

## 보안 주의사항

⚠️ **중요**:
- `.env` 파일을 절대 Git에 커밋하지 마세요
- Client Secret을 공개 저장소에 노출하지 마세요
- `.gitignore`에 `.env`가 포함되어 있는지 확인하세요

## 추가 정보

- [Google Calendar API 문서](https://developers.google.com/calendar/api/guides/overview)
- [OAuth 2.0 가이드](https://developers.google.com/identity/protocols/oauth2)
- [googleapis npm 패키지](https://www.npmjs.com/package/googleapis)

---

문제가 있거나 질문이 있으시면 이슈를 등록해주세요!